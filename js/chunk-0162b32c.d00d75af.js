(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0162b32c"],{ccf4:function(e,t,n){"use strict";n("f416")},da38:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this;e._self._c;return e._m(0)},r=[function(){var e=this,t=e._self._c;return t("div",[t("div",{attrs:{id:"map"}})])}],i=(n("8e6e"),n("75fc")),s=(n("ac6a"),n("456d"),n("bd86")),c=function(e,t){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},c(e,t)};function a(e,t){function n(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function u(e){var t="function"===typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function l(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{while((void 0===t||t-- >0)&&!(o=i.next()).done)s.push(o.value)}catch(c){r={error:c}}finally{try{o&&!o.done&&(n=i["return"])&&n.call(i)}finally{if(r)throw r.error}}return s}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var f=function(){function e(e,t){this.target=t,this.type=e}return e}(),p=function(e){function t(t,n){var o=e.call(this,"error",n)||this;return o.message=t.message,o.error=t,o}return a(t,e),t}(f),d=function(e){function t(t,n,o){void 0===t&&(t=1e3),void 0===n&&(n="");var r=e.call(this,"close",o)||this;return r.wasClean=!0,r.code=t,r.reason=n,r}return a(t,e),t}(f),_=function(){if("undefined"!==typeof WebSocket)return WebSocket},y=function(e){return"undefined"!==typeof e&&!!e&&2===e.CLOSING},m={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},g=function(){function e(e,t,n){var o=this;void 0===n&&(n={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(e){o._debug("open event");var t=o._options.minUptime,n=void 0===t?m.minUptime:t;clearTimeout(o._connectTimeout),o._uptimeTimeout=setTimeout((function(){return o._acceptOpen()}),n),o._ws.binaryType=o._binaryType,o._messageQueue.forEach((function(e){return o._ws.send(e)})),o._messageQueue=[],o.onopen&&o.onopen(e),o._listeners.open.forEach((function(t){return o._callEventListener(e,t)}))},this._handleMessage=function(e){o._debug("message event"),o.onmessage&&o.onmessage(e),o._listeners.message.forEach((function(t){return o._callEventListener(e,t)}))},this._handleError=function(e){o._debug("error event",e.message),o._disconnect(void 0,"TIMEOUT"===e.message?"timeout":void 0),o.onerror&&o.onerror(e),o._debug("exec error listeners"),o._listeners.error.forEach((function(t){return o._callEventListener(e,t)})),o._connect()},this._handleClose=function(e){o._debug("close event"),o._clearTimeouts(),o._shouldReconnect&&o._connect(),o.onclose&&o.onclose(e),o._listeners.close.forEach((function(t){return o._callEventListener(e,t)}))},this._url=e,this._protocols=t,this._options=n,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(e,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CONNECTING",{get:function(){return e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OPEN",{get:function(){return e.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSING",{get:function(){return e.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSED",{get:function(){return e.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){var e=this._messageQueue.reduce((function(e,t){return"string"===typeof t?e+=t.length:t instanceof Blob?e+=t.size:e+=t.byteLength,e}),0);return e+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?e.CLOSED:e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),e.prototype.close=function(e,t){void 0===e&&(e=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),this._ws?this._ws.readyState!==this.CLOSED?this._ws.close(e,t):this._debug("close: already closed"):this._debug("close enqueued: no ws instance")},e.prototype.reconnect=function(e,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED?(this._disconnect(e,t),this._connect()):this._connect()},e.prototype.send=function(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{var t=this._options.maxEnqueuedMessages,n=void 0===t?m.maxEnqueuedMessages:t;this._messageQueue.length<n&&(this._debug("enqueue",e),this._messageQueue.push(e))}},e.prototype.addEventListener=function(e,t){this._listeners[e]&&this._listeners[e].push(t)},e.prototype.dispatchEvent=function(e){var t,n,o=this._listeners[e.type];if(o)try{for(var r=u(o),i=r.next();!i.done;i=r.next()){var s=i.value;this._callEventListener(e,s)}}catch(c){t={error:c}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!0},e.prototype.removeEventListener=function(e,t){this._listeners[e]&&(this._listeners[e]=this._listeners[e].filter((function(e){return e!==t})))},e.prototype._debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._options.debug&&console.log.apply(console,h(["RWS>"],e))},e.prototype._getNextDelay=function(){var e=this._options,t=e.reconnectionDelayGrowFactor,n=void 0===t?m.reconnectionDelayGrowFactor:t,o=e.minReconnectionDelay,r=void 0===o?m.minReconnectionDelay:o,i=e.maxReconnectionDelay,s=void 0===i?m.maxReconnectionDelay:i,c=0;return this._retryCount>0&&(c=r*Math.pow(n,this._retryCount-1),c>s&&(c=s)),this._debug("next delay",c),c},e.prototype._wait=function(){var e=this;return new Promise((function(t){setTimeout(t,e._getNextDelay())}))},e.prototype._getNextUrl=function(e){if("string"===typeof e)return Promise.resolve(e);if("function"===typeof e){var t=e();if("string"===typeof t)return Promise.resolve(t);if(t.then)return t}throw Error("Invalid URL")},e.prototype._connect=function(){var e=this;if(!this._connectLock&&this._shouldReconnect){this._connectLock=!0;var t=this._options,n=t.maxRetries,o=void 0===n?m.maxRetries:n,r=t.connectionTimeout,i=void 0===r?m.connectionTimeout:r,s=t.WebSocket,c=void 0===s?_():s;if(this._retryCount>=o)this._debug("max retries reached",this._retryCount,">=",o);else{if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!y(c))throw Error("No valid WebSocket class provided");this._wait().then((function(){return e._getNextUrl(e._url)})).then((function(t){e._closeCalled||(e._debug("connect",{url:t,protocols:e._protocols}),e._ws=e._protocols?new c(t,e._protocols):new c(t),e._ws.binaryType=e._binaryType,e._connectLock=!1,e._addListeners(),e._connectTimeout=setTimeout((function(){return e._handleTimeout()}),i))}))}}},e.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new p(Error("TIMEOUT"),this))},e.prototype._disconnect=function(e,t){if(void 0===e&&(e=1e3),this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new d(e,t,this))}catch(n){}}},e.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},e.prototype._callEventListener=function(e,t){"handleEvent"in t?t.handleEvent(e):t(e)},e.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},e.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},e.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},e}(),b=g,v=n("5f87"),w=n("2f62"),O=n("5d2d"),E=n("267e");function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){Object(s["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C={p0:"wss://gz.cdnbye.com",p1:"wss://eu.cdnbye.com",p3:"wss://hk.swarmcloud.net",p2:"wss://tracker.hdtvcloud.com"},j=7e3,S={0:"#B22222",1:"#33ff33",2:"#33ff33",3:"#1C86EE",4:"#FFD700",5:"#FF7F00",6:"#B22222",7:"#A020F0",8:"#ffffff"},P={name:"GeoFly",data:function(){return{scene:null,ws:null,flyLineTimer:null,resizing:!1,resizingTimer:null,flag:!1}},computed:T({},Object(w["b"])(["profile","language"])),mounted:function(){var e=this;if("/geofly_all"===this.$route.path)this.initScene();else{var t=Object(O["a"])(E["c"]);this.profile.token?this.initScene(t):this.$store.dispatch("getProfile").then((function(){e.initScene(t)}))}},methods:{initScene:function(e){var t=this,n=new L7.Scene({id:"map",logoVisible:!1,map:new L7.Mapbox({pitch:0,style:"dark",zoom:2,token:"pk.eyJ1IjoiY2RuYnllIiwiYSI6ImNsMHE3ZmRxNDI3ZXczbHFrYm82Z2MyODEifQ.RTPyCND8dTNtHudmaQolwQ"})});this.scene=n;var o=new MapboxLanguage({defaultLanguage:"en"===this.language?"en":"zh-Hant"});n.map.addControl(o);var r=[],i=new L7.LineLayer({blend:"normal"}).size(.8).shape("greatcircle").color("color").animate({enable:!0,interval:.3,trailLength:.2,duration:3.5}).style({opacity:.6}),s=function(){t.flag&&!t.resizing&&(i.setData(r,{parser:{type:"json",x:"lon1",y:"lat1",x1:"lon2",y1:"lat2"}}),t.flag=!1)},c=function e(n){t.flyLineTimer=setTimeout((function(){s();var t=r.length;e(t<100?200:t<500?1e3:t<1e3?3e3:1e4)}),n)};c(200),n.on("loaded",(function(){if(n.addLayer(i),e){var o="".concat(C[e],"/flyline?uid=").concat(Object(v["a"])(),"&token=").concat(t.profile.token);t.createWS(o,r)}else for(var s=0,c=Object.keys(C);s<c.length;s++){var a=c[s],u="".concat(C[a],"/flyline?uid=0&admin_token=RF9ix9jkZhdA");t.createWS(u,r)}})),this.setupListener()},createWS:function(e,t){var n=this,o={maxRetries:5,minReconnectionDelay:5e3,maxReconnectionDelay:6e4},r=new b(e,void 0,o);this.ws=r,r.addEventListener("open",(function(){})),r.addEventListener("message",(function(e){var o,r,s=e.data;try{r=JSON.parse(s)}catch(e){return void alert(s)}var c=n.convert(r);(o=t).push.apply(o,Object(i["a"])(c)),t.length>j&&(t=t.slice(-j)),n.flag=!0}))},convert:function(e){var t=[],n=e.from,o=e.to;return n&&o?(0===o.length||o.forEach((function(e){e.typ||(e.typ=0),t.push({lat1:n.lat,lon1:n.lon,lat2:e.lat,lon2:e.lon,color:S[e.typ]||"#B22222"})})),t):t},setupListener:function(){var e=this,t=this.scene;t.on("movestart",(function(){e.handleResizing()})),t.on("zoomchange",(function(){e.handleResizing()})),t.on("zoomstart",(function(){e.handleResizing()})),t.on("dragging",(function(){e.handleResizing()}))},handleResizing:function(){var e=this;this.resizingTimer||(this.resizing=!0,this.resizingTimer=setTimeout((function(){e.resizing=!1,e.resizingTimer=null}),2e3))}},beforeDestroy:function(){clearTimeout(this.flyLineTimer),clearTimeout(this.resizingTimer),this.scene&&this.scene.destroy(),this.ws&&this.ws.close(1e3,"normal close")}},x=P,N=(n("ccf4"),n("2877")),D=Object(N["a"])(x,o,r,!1,null,null,null);t["default"]=D.exports},f416:function(e,t,n){}}]);