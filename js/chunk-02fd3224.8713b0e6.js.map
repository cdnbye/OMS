{"version":3,"sources":["webpack:///./src/views/p2pConfig/user/seederStats.vue","webpack:///src/views/p2pConfig/user/seederStats.vue","webpack:///./src/views/p2pConfig/user/seederStats.vue?9375","webpack:///./src/views/p2pConfig/user/seederStats.vue?7834","webpack:///./src/api/user/seeder.js"],"names":["render","_vm","this","_c","_self","directives","name","rawName","value","loading","expression","staticClass","staticStyle","attrs","model","callback","$$v","slot","action","on","$event","doAction","_v","_s","$t","jsonData","staticRenderFns","components","VueJsonPretty","mounted","methods","copyTo","Object","infos","channel","priority","live","keepAlive","copySeeder","target","then","title","type","finally","data","actionSeeder","getStats","uid","sid","master","worker","formatValue","beforeDestroy","clearInterval","component","createSeeder","request","url","method","getSeeders","deleteSeeder","updateSeeder"],"mappings":"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","file":"js/chunk-02fd3224.8713b0e6.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],staticClass:\"app-container\"},[_c('div',{staticStyle:{\"margin-bottom\":\"10px\"}},[_c('el-input',{staticStyle:{\"width\":\"350px\",\"margin-right\":\"5px\"},attrs:{\"placeholder\":\"worker pid, url or number\"},model:{value:(_vm.value),callback:function ($$v) {_vm.value=$$v},expression:\"value\"}},[_c('template',{slot:\"prepend\"},[_c('el-select',{staticStyle:{\"width\":\"110px\"},attrs:{\"slot\":\"prepend\",\"placeholder\":\"Select\"},slot:\"prepend\",model:{value:(_vm.action),callback:function ($$v) {_vm.action=$$v},expression:\"action\"}},[_c('el-option',{attrs:{\"label\":\"Restart\",\"value\":\"restart\"}}),_c('el-option',{attrs:{\"label\":\"Kill\",\"value\":\"kill\"}}),_c('el-option',{attrs:{\"label\":\"Migrate\",\"value\":\"copy\"}}),_c('el-option',{attrs:{\"label\":\"Workers\",\"value\":\"ping\"}}),_c('el-option',{attrs:{\"label\":\"Limits\",\"value\":\"limits\"}})],1)],1)],2),_c('el-button',{attrs:{\"type\":\"warning\"},on:{\"click\":function($event){return _vm.doAction()}}},[_vm._v(_vm._s(_vm.$t('common.ok')))])],1),_c('vue-json-pretty',{attrs:{\"showIcon\":\"\",\"showLineNumber\":\"\",\"showDoubleQuotes\":false,\"data\":_vm.jsonData}})],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"app-container\" v-loading=\"loading\">\n    <div style=\"margin-bottom: 10px\">\n      <el-input placeholder=\"worker pid, url or number\" v-model=\"value\" style=\"width: 350px; margin-right: 5px\">\n        <template slot=\"prepend\" >\n          <el-select v-model=\"action\" slot=\"prepend\" placeholder=\"Select\" style=\"width: 110px\">\n            <el-option label=\"Restart\" value=\"restart\"></el-option>\n            <el-option label=\"Kill\" value=\"kill\"></el-option>\n            <el-option label=\"Migrate\" value=\"copy\"></el-option>\n            <el-option label=\"Workers\" value=\"ping\"></el-option>\n            <el-option label=\"Limits\" value=\"limits\"></el-option>\n          </el-select>\n        </template>\n      </el-input>\n      <el-button type=\"warning\" @click=\"doAction()\">{{ $t('common.ok') }}</el-button>\n    </div>\n    <vue-json-pretty\n        showIcon\n        showLineNumber\n        :showDoubleQuotes=\"false\"\n        :data=\"jsonData\" />\n  </div>\n</template>\n\n<script>\nimport { actionSeeder, copySeeder } from '@/api/user/seeder'\nimport { getID } from '@/utils/auth'\nimport { formatTraffic, formatDuration } from '@/utils/format'\nimport VueJsonPretty from 'vue-json-pretty';\nimport 'vue-json-pretty/lib/styles.css';\n\nexport default {\n  name: \"seederStats\",\n  components: {\n    VueJsonPretty,\n  },\n  mounted() {\n    const { sid } = this.$route.query\n    this.sid = sid\n    const uid = getID()\n    this.getStats(uid, sid)\n    this.timer = setInterval(() => {\n      this.getStats(uid, sid)\n    }, 20000)\n  },\n  methods: {\n    copyTo() {\n      const infos = []\n      const json = this.jsonData\n      if (json.workers) {\n        Object.keys(json.workers).forEach(key => {\n          const worker = json.workers[key]\n          if (worker.channelId) {\n            infos.push({\n              channel: worker.channelId,\n              priority: worker.priority,\n              live: !worker.isVod,\n              keepAlive: worker.keepAlive,\n            })\n          }\n        })\n      }\n      this.loading = true\n      copySeeder(getID(), {\n        infos,\n        target: this.value,\n      }).then(() => {\n        this.$notify({\n          title: this.$t('common.success'),\n          type: 'success'\n        });\n        this.value = ''\n        this.action = ''\n      }).finally(() => {\n        this.loading = false\n      })\n    },\n    doAction() {\n      if (this.action === 'copy') {\n        this.copyTo()\n        return\n      }\n      if (!this.action) return\n      this.loading = true\n      const data = {\n        action: this.action,\n      }\n      if (this.action === 'ping' || this.action === 'limits') {\n        data.workers = Number(this.value)\n      } else {\n        const pids = this.value.split(' ').filter(pid => !!pid).map(pid => Number(pid))\n        if (pids.length === 1) {\n          data.pid = pids[0]\n        } else {\n          data.pids = pids\n        }\n      }\n      actionSeeder(getID(), this.sid, data).then(() => {\n        this.$notify({\n          title: this.$t('common.success'),\n          type: 'success'\n        });\n        this.value = ''\n        this.action = ''\n      }).finally(() => {\n        this.loading = false\n      })\n    },\n    getStats(uid, sid) {\n      this.loading = true\n      actionSeeder(uid, sid, {\n        action: 'stats'\n      }).then(resp => {\n        const json = JSON.parse(resp.data)\n        const { master, workers } = json;\n        if (master) {\n          master.memory = this.formatValue(master.memory)\n          master.elapsed = formatDuration(master.elapsed)\n          if (master.averageUplink) {\n            master.averageUplink = `${Math.round(master.averageUplink)}Mbps`\n          }\n        }\n        if (workers) {\n          Object.keys(workers).forEach(key => {\n            const worker = workers[key]\n            if (worker.seedFrom) {\n              worker.seedFrom = new Date(worker.seedFrom)\n              worker.uploaded = this.formatValue(worker.uploaded)\n              worker.downloaded = this.formatValue(worker.downloaded)\n            }\n            if (worker.averageUplink) {\n              worker.averageUplink = `${Math.round(worker.averageUplink)}Mbps`\n            }\n            if (worker.diskCacheSize) {\n              worker.diskCacheSize = this.formatValue(worker.diskCacheSize)\n            }\n            if (worker.memory) {\n              worker.memory = this.formatValue(worker.memory)\n            }\n          })\n        }\n        this.jsonData = json\n      }).finally(() => {\n        this.loading = false\n      })\n    },\n    formatValue(value) {\n      const obj = formatTraffic(value)\n      return `${obj.num}${obj.unit}`\n    }\n  },\n  data() {\n    return {\n      loading: false,\n      action: '',\n      sid: 0,\n      value: '',\n      jsonData: {},\n    }\n  },\n  beforeDestroy() {\n    clearInterval(this.timer)\n  }\n}\n</script>\n\n<style scoped>\n\n</style>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./seederStats.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./seederStats.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./seederStats.vue?vue&type=template&id=47cf881e&scoped=true&\"\nimport script from \"./seederStats.vue?vue&type=script&lang=js&\"\nexport * from \"./seederStats.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"47cf881e\",\n  null\n  \n)\n\nexport default component.exports","import request from '@/utils/request'\n\nexport function createSeeder(uid, data) {\n    return request({\n        url: `seeder/user_id/${uid}`,\n        method: 'post',\n        data\n    })\n}\n\nexport function getSeeders(uid) {\n    return request({\n        url: `seeder/user_id/${uid}`,\n        method: 'get',\n    })\n}\n\nexport function deleteSeeder(uid, sid) {\n    return request({\n        url: `seeder/user_id/${uid}/seeder_id/${sid}`,\n        method: 'delete',\n    })\n}\n\nexport function updateSeeder(uid, sid, data) {\n    return request({\n        url: `seeder/user_id/${uid}/seeder_id/${sid}`,\n        method: 'put',\n        data\n    })\n}\n\nexport function actionSeeder(uid, sid, data) {\n    return request({\n        url: `seeder/user_id/${uid}/seeder_id/${sid}`,\n        method: 'post',\n        data\n    })\n}\n\nexport function copySeeder(uid, data) {\n    return request({\n        url: `seeder/user_id/${uid}/copy`,\n        method: 'post',\n        data\n    })\n}\n\n\n"],"sourceRoot":""}