{"version":3,"sources":["webpack:///./src/views/p2pConfig/user/signalManage.vue","webpack:///src/views/p2pConfig/user/signalManage.vue","webpack:///./src/views/p2pConfig/user/signalManage.vue?004b","webpack:///./src/views/p2pConfig/user/signalManage.vue?9427","webpack:///./src/api/user/p2pConfig.js"],"names":["render","_vm","this","_c","_self","style","device","staticStyle","attrs","$t","_v","_s","directives","name","rawName","value","loading","expression","tableData","formatterStatus","scopedSlots","_u","key","fn","scope","minRows","maxRows","model","row","signals","callback","$$v","$set","signals2","blocked","_e","signal_enabled","nativeOn","$event","preventDefault","handleSubmit","staticClass","tableParam","pageSize","page","on","handleSizeChange","handleCurrentChange","staticRenderFns","data","applyAll","id","domain","computed","mapGetters","created","methods","fetchTableData","fetchUserDomain","isvalid","catch","handleSignalAddr","uid","updateSignalAddr","title","message","type","enabled","component","p2pConfig","user_id","domain_id","request","url","method","p2pConfigWifiOnly","p2pConfigRatio","p2pConfigUrgentRatio","updateStuns"],"mappings":"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","file":"js/chunk-8417c90a.a3b8e967.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{style:(_vm.device === 'mobile' ? '' : 'padding: 30px 120px')},[_c('el-alert',{staticStyle:{\"margin-bottom\":\"20px\"},attrs:{\"title\":_vm.$t('p2pConfig.signalManage.desc')}},[[_c('br'),_c('br'),_c('a',{staticStyle:{\"color\":\"#337ab7\",\"font-weight\":\"bold\"},attrs:{\"target\":\"view_window\",\"href\":\"https://swarmcloud.net/views/signaling.html#official-signaling-service\"}},[_vm._v(_vm._s(_vm.$t('p2pConfig.signalManage.official'))+\" ->\")])]],2),_c('el-table',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],attrs:{\"border\":\"\",\"data\":_vm.tableData}},[_c('el-table-column',{attrs:{\"align\":\"center\",\"prop\":\"domain\",\"label\":_vm.$t('p2pConfig.name'),\"min-width\":\"100\"}}),_c('el-table-column',{attrs:{\"align\":\"center\",\"formatter\":_vm.formatterStatus,\"label\":_vm.$t('p2pConfig.signalManage.signalAddr'),\"min-width\":\"150\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-input',{attrs:{\"placeholder\":\"wss://\",\"type\":\"textarea\",\"autosize\":{ minRows: 1, maxRows: 10},\"clearable\":\"\"},model:{value:(scope.row.signals),callback:function ($$v) {_vm.$set(scope.row, \"signals\", $$v)},expression:\"scope.row.signals\"}})]}}])}),_c('el-table-column',{attrs:{\"align\":\"center\",\"formatter\":_vm.formatterStatus,\"label\":_vm.$t('p2pConfig.signalManage.signalAddr2'),\"min-width\":\"130\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [_c('el-input',{attrs:{\"placeholder\":\"wss://\",\"type\":\"textarea\",\"autosize\":{ minRows: 1, maxRows: 10},\"clearable\":\"\"},model:{value:(scope.row.signals2),callback:function ($$v) {_vm.$set(scope.row, \"signals2\", $$v)},expression:\"scope.row.signals2\"}})]}}])}),_c('el-table-column',{attrs:{\"align\":\"center\",\"formatter\":_vm.formatterStatus,\"min-width\":\"50\",\"width\":\"120\",\"label\":_vm.$t('p2pConfig.signalManage.switch')},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(!scope.row.blocked)?_c('el-switch',{attrs:{\"active-color\":\"#13ce66\",\"inactive-color\":\"#ff4949\"},model:{value:(scope.row.signal_enabled),callback:function ($$v) {_vm.$set(scope.row, \"signal_enabled\", $$v)},expression:\"scope.row.signal_enabled\"}}):_vm._e()]}}])}),_c('el-table-column',{attrs:{\"label\":_vm.$t('domainTable.operation'),\"align\":\"center\",\"min-width\":\"50\",\"width\":\"120\"},scopedSlots:_vm._u([{key:\"default\",fn:function(scope){return [(!scope.row.blocked)?_c('el-button',{attrs:{\"loading\":_vm.loading,\"type\":\"primary\"},nativeOn:{\"click\":function($event){$event.preventDefault();return _vm.handleSubmit(scope.row)}}},[_vm._v(_vm._s(_vm.$t('common.ok')))]):_vm._e()]}}])})],1),_c('div',{staticClass:\"pagination-container\"},[_c('el-pagination',{attrs:{\"layout\":\"sizes, prev, pager, next\",\"page-sizes\":[10, 20, 50, 100],\"page-size\":_vm.tableParam.pageSize,\"current-page\":_vm.tableParam.page},on:{\"size-change\":_vm.handleSizeChange,\"current-change\":_vm.handleCurrentChange}})],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div :style=\"device === 'mobile' ? '' : 'padding: 30px 120px'\">\n        <el-alert :title=\"$t('p2pConfig.signalManage.desc')\" style=\"margin-bottom: 20px\">\n          <template>\n            <br>\n            <br>\n            <a style=\"color: #337ab7; font-weight: bold\" target=\"view_window\" href=\"https://swarmcloud.net/views/signaling.html#official-signaling-service\">{{ $t('p2pConfig.signalManage.official') }} -></a>\n          </template>\n        </el-alert>\n        <el-table border :data=\"tableData\" v-loading=\"loading\">\n            <el-table-column align=\"center\" prop=\"domain\" :label=\"$t('p2pConfig.name')\"  min-width=\"100\"></el-table-column>\n            <el-table-column align=\"center\" :formatter=\"formatterStatus\"\n                             :label=\"$t('p2pConfig.signalManage.signalAddr')\"\n                             min-width=\"150\">\n                <template slot-scope=\"scope\">\n                    <el-input\n                            placeholder=\"wss://\"\n                            type=\"textarea\"\n                            v-model=\"scope.row.signals\"\n                            :autosize=\"{ minRows: 1, maxRows: 10}\"\n                            clearable\n                            >\n                    </el-input>\n                </template>\n            </el-table-column>\n            <el-table-column align=\"center\" :formatter=\"formatterStatus\"\n                             :label=\"$t('p2pConfig.signalManage.signalAddr2')\"\n                             min-width=\"130\">\n              <template slot-scope=\"scope\">\n                <el-input\n                    placeholder=\"wss://\"\n                    type=\"textarea\"\n                    v-model=\"scope.row.signals2\"\n                    :autosize=\"{ minRows: 1, maxRows: 10}\"\n                    clearable\n                >\n                </el-input>\n              </template>\n            </el-table-column>\n            <el-table-column align=\"center\" :formatter=\"formatterStatus\" min-width=\"50\" width=\"120\"\n                             :label=\"$t('p2pConfig.signalManage.switch')\">\n                <template slot-scope=\"scope\">\n                    <el-switch v-if=\"!scope.row.blocked\" v-model=\"scope.row.signal_enabled\" active-color=\"#13ce66\" inactive-color=\"#ff4949\"> </el-switch>\n                </template>\n            </el-table-column>\n\n            <el-table-column :label=\"$t('domainTable.operation')\" align=\"center\"  min-width=\"50\" width=\"120\">\n                <template slot-scope=\"scope\">\n                    <el-button v-if=\"!scope.row.blocked\" :loading=\"loading\" type=\"primary\" @click.native.prevent=\"handleSubmit(scope.row)\">{{$t('common.ok')}}</el-button>\n                </template>\n            </el-table-column>\n\n        </el-table>\n\n        <div class=\"pagination-container\">\n            <el-pagination\n                    layout=\"sizes, prev, pager, next\"\n                    :page-sizes=\"[10, 20, 50, 100]\"\n                    :page-size=\"tableParam.pageSize\"\n                    :current-page=\"tableParam.page\"\n                    @size-change=\"handleSizeChange\"\n                    @current-change=\"handleCurrentChange\">\n            </el-pagination>\n        </div>\n\n    </div>\n</template>\n\n<script>\n    import { fetchUserDomain } from '@/api/userDomain'\n    import { updateSignalAddr } from '@/api/user/p2pConfig'\n    import {mapGetters} from 'vuex'\n    import { trim } from '@/utils'\n\n    const APPLY_TO_ALL = '*Apply To All*'\n\n    export default {\n        name: 'signalManage',\n        data() {\n            return {\n                loading: false,\n                tableData: [],\n                tableParam: {\n                    page: 1,\n                    pageSize: 10\n                },\n                applyAll: {\n                  id: 0,\n                  domain: APPLY_TO_ALL,\n                  signals: '',\n                  signals2: '',\n                  signal_enabled: true,\n                  blocked: false,\n                }\n            }\n        },\n        computed: {\n            ...mapGetters([\n                'device'\n            ])\n        },\n        created() {\n            this.fetchTableData()\n        },\n        methods: {\n            formatterStatus(row) {\n                if (row.blocked) {\n                    return this.$t('common.illegal')\n                }\n                // if (row.reviewing) {\n                //     return this.$t('common.reviewing')\n                // }\n                return \"\"\n            },\n            fetchTableData(page = this.tableParam.page, pageSize = this.tableParam.pageSize) {\n                this.loading = true\n                fetchUserDomain(page, pageSize, {isvalid: true}).then(res => {\n                    if (res.data) {\n                        this.tableData = res.data\n                        this.tableData.forEach(row => {\n                          // console.warn(row)\n                          if (row.signals && row.signals.length >= 0) {\n                            row.signals = row.signals.join('\\n')\n                          }\n                          if (row.signals2 && row.signals2.length >= 0) {\n                            row.signals2 = row.signals2.join('\\n')\n                          }\n                        })\n                        if (this.tableData.length > 1) {\n                          this.applyAll.uid = this.tableData[0].uid\n                          this.tableData.unshift(this.applyAll)\n                        }\n                    }\n                    this.loading = false\n                }).catch(() => {\n                    this.loading = false\n                })\n            },\n            handleSignalAddr(uid, id, data) {\n                this.loading = true\n                updateSignalAddr(uid, id, data).then(res => {\n                    if (res.data.succeed) {\n                        this.$notify({\n                            title: this.$t('common.success'),\n                            message: this.$t('p2pConfig.configSuccess'),\n                            type: 'success'\n                        });\n                        if (id === 0) {\n                          this.fetchTableData()\n                        }\n                    } else {\n                        const msg = res.data.msg || this.$t('p2pConfig.configFail')\n                        this.$notify.error({\n                            title: this.$t('common.error'),\n                            message: msg,\n                        });\n                    }\n                    this.loading = false\n                })\n                .catch(() => {\n                    this.loading = false\n                })\n            },\n            handleSubmit(domain) {\n                let signals;\n                if (!domain.signals) {\n                    signals = []\n                } else {\n                    signals = domain.signals.split('\\n').map(signal => trim(signal)).filter(signal => {\n                        return signal !== \"\"\n                    })\n                }\n              let signals2;\n                if (!domain.signals2) {\n                    signals2 = []\n                } else {\n                    signals2 = domain.signals2.split('\\n').map(signal => trim(signal)).filter(signal => {\n                        return signal !== \"\"\n                    })\n                }\n                const data = {signals, signals2, enabled: domain.signal_enabled};\n                this.handleSignalAddr(domain.uid, domain.id, data)\n            },\n            handleSizeChange(pageSize) {\n                this.tableParam.pageSize = pageSize\n                this.fetchTableData()\n            },\n            handleCurrentChange(page) {\n                this.tableParam.page = page\n                this.fetchTableData()\n            },\n        },\n    }\n</script>\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./signalManage.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./signalManage.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./signalManage.vue?vue&type=template&id=3ce67167&\"\nimport script from \"./signalManage.vue?vue&type=script&lang=js&\"\nexport * from \"./signalManage.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import request from '@/utils/request'\n\n// 用户配置网站p2p开关\nexport function p2pConfig(user_id, domain_id, data) {\n  return request({\n    url: `user/user_id/${user_id}/domain/domain_id/${domain_id}/control`,\n    method: 'post',\n    data\n  })\n}\n\n// 配置wifi only\nexport function p2pConfigWifiOnly(user_id, domain_id, data) {\n    return request({\n        url: `user/user_id/${user_id}/domain/domain_id/${domain_id}/control/wifi_only`,\n        method: 'post',\n        data\n    })\n}\n\n// 配置p2p激活比率\nexport function p2pConfigRatio(user_id, domain_id, data) {\n    return request({\n        url: `user/user_id/${user_id}/domain/domain_id/${domain_id}/control/ratio`,\n        method: 'post',\n        data\n    })\n}\n\n// 配置p2p urgent ratio\nexport function p2pConfigUrgentRatio(user_id, domain_id, data) {\n    return request({\n        url: `user/user_id/${user_id}/domain/domain_id/${domain_id}/control/urgent_ratio`,\n        method: 'post',\n        data\n    })\n}\n\n// 配置信令地址\nexport function updateSignalAddr(user_id, domain_id, data) {\n    return request({\n        url: `user/user_id/${user_id}/domain/domain_id/${domain_id}/control/signal`,\n        method: 'post',\n        data\n    })\n}\n\n// 新增stun\nexport function updateStuns(user_id, domain_id, data) {\n    return request({\n        url: `user/user_id/${user_id}/domain/domain_id/${domain_id}/control/stun`,\n        method: 'post',\n        data\n    })\n}\n\n"],"sourceRoot":""}